<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tommaso Trotto &amp; Jen Baron (tommaso.trotto@ubc.ca)">
<meta name="dcterms.date" content="2024-10-19">

<title>GEM500: Estimating Landscape Patterns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introducing-landscape-patterns" id="toc-introducing-landscape-patterns" class="nav-link active" data-scroll-target="#introducing-landscape-patterns">Introducing landscape patterns</a></li>
  <li><a href="#exploring-basic-landscape-metrics" id="toc-exploring-basic-landscape-metrics" class="nav-link" data-scroll-target="#exploring-basic-landscape-metrics">Exploring basic landscape metrics</a>
  <ul class="collapse">
  <li><a href="#list-available-metrics" id="toc-list-available-metrics" class="nav-link" data-scroll-target="#list-available-metrics">List available metrics</a></li>
  <li><a href="#metric-calculation" id="toc-metric-calculation" class="nav-link" data-scroll-target="#metric-calculation">Metric calculation</a></li>
  <li><a href="#work-on-your-own" id="toc-work-on-your-own" class="nav-link" data-scroll-target="#work-on-your-own">Work on your own</a></li>
  </ul></li>
  <li><a href="#working-with-continuous-data" id="toc-working-with-continuous-data" class="nav-link" data-scroll-target="#working-with-continuous-data">Working with continuous data</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GEM500: Estimating Landscape Patterns</h1>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tommaso Trotto &amp; Jen Baron (tommaso.trotto@ubc.ca) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introducing-landscape-patterns" class="level1">
<h1>Introducing landscape patterns</h1>
<p>Landscape patterns and their quantification has received considerable attention since the early 1980’s. The quantification of landscape patterns came from the need to objectively describe landscapes that humans assess subjectively as, for example, “clumpy”, “dispersed”, “random”, “diverse”, “fragmented”, or “connected” (<span class="citation" data-cites="gergel2017">Gergel and Turner (<a href="#ref-gergel2017" role="doc-biblioref">2017</a>)</span>). Quantification of pattern is fundamental to many of the relationships we seek to understand in landscape ecology, because they emphasize the interactions among spatial patterns and ecological processes. Therefore, a basic familiarity with the most commonly used ways to quantify these patterns is extremely important (<span class="citation" data-cites="gergel2017">Gergel and Turner (<a href="#ref-gergel2017" role="doc-biblioref">2017</a>)</span>). In general, we refer to these as <strong>landscape metrics</strong>. Landscape metrics allow us to objectively describe landscape patterns based on certain observable features, which enable analyses such as:</p>
<ul>
<li>Assessment of landscape pattern changes over time</li>
<li>Making future predictions regarding landscape pattern changes</li>
<li>Determining if two landscape differ based on their patterns</li>
<li>Evaluating alternative lands management strategies in terms of the landscape patterns that may result</li>
<li>Determining if a certain pattern is characteristic of a specific disturbance</li>
</ul>
<p>In particular, in this lab we will take advantage of both R- and python-based libraries to objectively quantify landscape patterns to answer specific research questions. Both these libraries are inspired by FRAGSTATS (<span class="citation" data-cites="mcgarigal1995">McGarigal (<a href="#ref-mcgarigal1995" role="doc-biblioref">1995</a>)</span>). More in details, we will explore the use of landscape metics to compare spatial patterns created by 5 different fires (<a href="#fig-fires" class="quarto-xref">Figure&nbsp;3</a>) using landscape metrics. Furthermore, we will focus on comparing spatial patterns of fires of different severity to see how they produce different spatial responses on the landscape.</p>
<p>Note that one core assumption that these and other methods take is that the input data source is a 2-dimensional (2D) <strong>categorical raster</strong>. A categorical raster is a raster product that describes homogeneous landscape features with integer numbers (<a href="#fig-lands" class="quarto-xref">Figure&nbsp;1</a>). This assumption is fundamental for the calculation of landscape metrics as they all base their equations on individual pixels. We will explore this aspect more in depth later on. However, it is often the case that you’d need to convert your <strong>continuous raster</strong> product into a categorical raster. The simplest way to do it is to define a threshold value where pixels above or below such threshold are assing a class or another. Conversion is a crucial step in the calculation of landscape patterns, because the selection of the threshold value would affect how the quantification of the landscape patterns of interest.</p>
<div id="fig-lands" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lands-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data/sim_lands.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lands-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Simulated landscapes representing 3 categories/classes (urban, agriculture, and forest) and their change over time.
</figcaption>
</figure>
</div>
<p>Another important concept to understand is <strong>neighboring</strong>. When working with landscape metrics, individual pixels and their neighbors are both important. Take for example <a href="#fig-nn" class="quarto-xref">Figure&nbsp;2</a>, we are working with the central pixel marked with a cross. How do we define a uniform patch or region? Do we consider only the pixels north-south and west-east, or do we also consider the diagonals? This is important because by changing the neighboring rule we change how patches, and therefore metrics, are interpreted and calculated. For example, using a 4-neighboring rule, the patch would have an areas of 5, whereas using an 8-neighboring rule it would have an areas of 9!</p>
<div id="fig-nn" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data/neighbors.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Illustration of 2 neighboring rules: (left) 4-neighbors, (right) 8-neighbors.
</figcaption>
</figure>
</div>
</section>
<section id="exploring-basic-landscape-metrics" class="level1">
<h1>Exploring basic landscape metrics</h1>
<p>Here, we will calculate landscape metrics from a categorical fire severity map using both R- and python-based solution. In R we are using the <code>landscapemetrics</code> library (<span class="citation" data-cites="hesselbarth2019">Hesselbarth et al. (<a href="#ref-hesselbarth2019" role="doc-biblioref">2019</a>)</span>), in python <code>pylandstats</code> (<span class="citation" data-cites="bosch2019">Bosch (<a href="#ref-bosch2019" role="doc-biblioref">2019</a>)</span>). Our objective is to describe landscape patterns created by 5 fire events of varying severity in Greater Yellowstone. Let’s start by importing libraries and data. In the following chunks, only the R code is evaluated because is more user-friendly than the python alternative as of today.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pylandstats <span class="im">as</span> pls</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># import fire rasters</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>fires <span class="op">=</span> <span class="bu">sorted</span>(glob(<span class="st">'data/fire*.tif'</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>lands <span class="op">=</span> [pls.Landscape(fire, nodata<span class="op">=</span><span class="dv">99</span>, neighborhood_rule<span class="op">=</span><span class="dv">8</span>) <span class="cf">for</span> fire <span class="kw">in</span> fires]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">15</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, fire <span class="kw">in</span> <span class="bu">enumerate</span>(fires):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rioxarray.open_rasterio(fire).squeeze() <span class="im">as</span> src:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> xr.where(src <span class="op">==</span> <span class="dv">99</span>, np.nan, src)  <span class="co"># fix plotting issues with pylandstats</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        src.plot.imshow(ax<span class="op">=</span>axes.flat[i])</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># explore 1 raster data</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>src</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(landscapemetrics)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>fires <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">'data'</span>, <span class="at">pattern =</span> <span class="st">'fire'</span>, <span class="at">full.names =</span> T)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># set NAflag</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>flagged <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fires, <span class="cf">function</span>(f) {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">rast</span>(f)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NAflag</span>(r) <span class="ot">&lt;-</span> <span class="dv">99</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crs</span>(r) <span class="ot">&lt;-</span> <span class="st">'epsg:32612'</span>  <span class="co"># manually assing CRS because originally missing</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>(r) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nodata"</span>, <span class="st">"unburned"</span>, <span class="st">"burned"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(r)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> <span class="fu">rast</span>(flagged)) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lyr, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'unburned'</span> <span class="ot">=</span> <span class="st">'#c1be7a'</span>, <span class="st">'burned'</span> <span class="ot">=</span> <span class="st">'#9f0a1a'</span>, <span class="st">'nodata'</span> <span class="ot">=</span> <span class="st">'#ababab'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fires" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fires-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fires-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fires-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Map of 5 fires in Greater Yellowstone of different severity
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># explore 1 raster data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>flagged[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 165, 165, 1  (nrow, ncol, nlyr)
resolution  : 30, 30  (x, y)
extent      : 0, 4950, 0, 4950  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 12N (EPSG:32612) 
source      : fire_1_high.tif 
categories  : category 
name        : fire_1_high 
min value   :          NA 
max value   :          NA </code></pre>
</div>
</div>
<p>Note how we have 2 classes and a “nodata” class. Class 1 represents unburned areas and class 2 represents burned areas. Class 99 is our nodata class. Now that we have some basic information on the landscape, we should check that everything is right. That is, check that the coordinate reference system (CRS) is right, and that we have the right number of classes. This is pretty straighforward. You would notice that the rasters have a CRS = EPSG:4326. In python you can check the CRS using <code>src.spatial_ref</code>. If the field is populated, explore it. In R, the <code>landscapemetrics</code> package offers the <code>check_landscape</code> function. So just type <code>check_landscape(flagged[[1]])</code> to see if the first raster is ready to go.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_landscape</span>(flagged[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  layer       crs units   class n_classes OK
1     1 projected     m integer         2  ✔</code></pre>
</div>
</div>
<p>We see that the raster is ready to go!</p>
<section id="list-available-metrics" class="level2">
<h2 class="anchored" data-anchor-id="list-available-metrics">List available metrics</h2>
<p>The <code>landscapemetrics</code> package includes a function to show you all available metrics and filter them according to the characteristics of the landscape they conceptually describe. For help, have a look at the help page of the <code>list_lsm()</code> function. You would see the acronym and full name of all the available metrics, the type, and the level they are applied to. For example. we can calculate metrics at the <code>patch</code>-, <code>class</code>-, or <code>landscape</code>-level. The syntax is pretty simple. All metrics start with <code>lsm_</code>, followed by the level (<code>p/c/l</code>), and the function name. Some of these metrics have other parameters that can be passed (e.g.&nbsp;neighboring rule). In some cases, legacy parameters are carried forward, so you will end up with metrics that have both a <code>neighbors</code> and <code>direction</code> parameters. They mean the same thing, but for legacy purposes they are retained to this point. In case, give the same value to both to be sure they are interpreted as you would expect.</p>
<p>With <code>pylandstats</code> is a bit more tricky. You’d need to explore the online documentation or the properties of a <code>Landscape</code> object as it is generated using <code>landscape = pls.Landscape()</code>. By using <code>dir(landscape)</code> you can see the list of available properties associated with the object. However, for a more detailed description, refer to the <a href="https://pylandstats.readthedocs.io/en/v2.3.0/index.html">online documentation</a>.</p>
</section>
<section id="metric-calculation" class="level2">
<h2 class="anchored" data-anchor-id="metric-calculation">Metric calculation</h2>
<p>Let’s explore how to actually use the libraries. A metric of interest for fire is <code>area</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lands[<span class="dv">0</span>].area()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lsm_p_area</span>(flagged[[<span class="dv">1</span>]], <span class="at">directions =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 115 × 6
   layer level class    id metric   value
   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;
 1     1 patch     1     1 area      1.08
 2     1 patch     1     2 area   2121.  
 3     1 patch     1     3 area      0.09
 4     1 patch     1     4 area      4.77
 5     1 patch     1     5 area      0.09
 6     1 patch     1     6 area      0.09
 7     1 patch     1     7 area      0.09
 8     1 patch     1     8 area      0.27
 9     1 patch     1     9 area      0.09
10     1 patch     1    10 area      0.09
# ℹ 105 more rows</code></pre>
</div>
</div>
<p>Here we see that the functions both output the area associated to each patch in the first landscape. In total, we have 115 patches identified using a 8-neighboring rule. Note that the python output is 0-indexed, whereas the R output is 1-indexed. The area values are unitless, so care must be taken when interpreting these metrics. We also see that there is a <code>class</code> column. This matches the length of our classes (1-2), so within each class, we have a certain number of patches. In particular, 49 patches for class 1 and 66 for class 2.</p>
<p>A great feature about the R library is that all metrics are returned in the same format. You will always have a tibble with the same number of columns and naming such that you can easily combine the output of different metrics into a single dataframe. In python, it’s a bit more complicated to do as values are either returned as dataframes or numbers.</p>
<p>What if we wanted to extract multiple metrics at a time. That’s another easy task! We can use the <code>calculate_lsm</code> function in the <code>landscapemetrics</code> package to calculate multiple metrics for a specific “level” and “type” (as defined by <code>lsm_list()</code>) or we can specify the <code>what</code> parameter for an ad-hoc list of metrics of interest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all metrics by level and type</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>patch_level <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(<span class="at">landscape =</span> flagged[[<span class="dv">1</span>]], </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">level =</span> <span class="st">"patch"</span>, <span class="at">type =</span> <span class="st">"area and edge metric"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>patch_level</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 345 × 6
   layer level class    id metric   value
   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;
 1     1 patch     1     1 area      1.08
 2     1 patch     1     2 area   2121.  
 3     1 patch     1     3 area      0.09
 4     1 patch     1     4 area      4.77
 5     1 patch     1     5 area      0.09
 6     1 patch     1     6 area      0.09
 7     1 patch     1     7 area      0.09
 8     1 patch     1     8 area      0.27
 9     1 patch     1     9 area      0.09
10     1 patch     1    10 area      0.09
# ℹ 335 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics of interest</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>multiple_metrics <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(<span class="at">landscape =</span> flagged[[<span class="dv">1</span>]], </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">what =</span> <span class="fu">c</span>(<span class="st">"lsm_p_area"</span>, <span class="st">"lsm_p_para"</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>multiple_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 230 × 6
   layer level class    id metric   value
   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;
 1     1 patch     1     1 area      1.08
 2     1 patch     1     2 area   2121.  
 3     1 patch     1     3 area      0.09
 4     1 patch     1     4 area      4.77
 5     1 patch     1     5 area      0.09
 6     1 patch     1     6 area      0.09
 7     1 patch     1     7 area      0.09
 8     1 patch     1     8 area      0.27
 9     1 patch     1     9 area      0.09
10     1 patch     1    10 area      0.09
# ℹ 220 more rows</code></pre>
</div>
</div>
<p>With a similar logic, you can calculate a list of metrics of interest using the <code>pylandstats</code> by iteratively calling the methods of the <code>Landscape</code> object.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list of metrics of interest</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>moi <span class="op">=</span> [<span class="st">'area'</span>, <span class="st">'perimeter'</span>, <span class="st">'perimeter_area_ratio'</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>multiple_metrics <span class="op">=</span> [<span class="bu">getattr</span>(lands[<span class="dv">0</span>], metric)() <span class="cf">for</span> metric <span class="kw">in</span> moi]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: pd.merge(x, y), multiple_metrics)  <span class="co"># merge because it's the same type and index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that we have calculated all patch-level metrics. If we wanted to “level-up” and calculate class-level metrics, sometimes it’s as easy as applying an aggregation function to patch-level metrics. For example the class-level area is given by the mean of the patch-level areas per class:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>area_patch <span class="op">=</span> lands[<span class="dv">0</span>].area()[<span class="st">'area'</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>area_class <span class="op">=</span> lands[<span class="dv">0</span>].area_mn()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>When calling <code>np.allclose(np.mean(area_patch), area_class)</code> we get <code>True</code>! In other cases the aggregation is a bit more tricky, but for class- and landscape-level metrics it’s always an aggregation of lower-level metrics.</p>
</section>
<section id="work-on-your-own" class="level2">
<h2 class="anchored" data-anchor-id="work-on-your-own">Work on your own</h2>
<p>Now that you have a sense of how landscape metrics work and how they can be calculated, it’s your time to explore some of these metrics in more depth! You are now tasked to quantify fire patterns using a series of landscape metrics we provide in addition to a set of metrics <em>of your choice</em>. Choosing which metrics to use could be a daunting task, but remember that a long list of metrics may result redundant as many metrics report values that are more or less correlated with each other. For example, a large patch is also likely to have a large perimeter, therefore you would select either one or another, not both. Otherwise, you can work with metrics that summarize the relationship between the two, for example using the perimeter-to-area ratio.</p>
<p>We think that a good initial approach to quantify spatial patterns of fire is by looking at the shape of the burned patches, their number, size, the proportion of the landscape they occupy, and how they are distributed in relation to one another (e.g.&nbsp;clumped/sparse). In particular, we are interested in looking at the following metrics (using the <code>landscapemetrics</code> package as reference):</p>
<ul>
<li><ins>
Landscape-level metrics
</ins>
: edge density (ED) and contagion (CONTAG)</li>
<li><ins>
Class-level metrics
</ins>
: proportion of landscape occupied (PLAND), number of patches (NP), and mean patch size (AREA_MN)</li>
</ul>
<p>To the list of this metrics, we ask you to provide 5 more additional ones to better explore the spatial pattern of fire in a way we are not able to capture using the metrics we proposed. Calculate these metrics for all fire rasters you have. This can be accomplished using a simple <code>for loop</code> in python or by feeding a list of rasters to the <code>calculate_lsm</code> function in R. Use a 8-neighboring rule for your metrics if applicable. You can conduct the analysis in the language you are the most comfortable with. Your coding skills are not subject to any grading in our labs.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take a look at higher-level classes for the selection of your 5 new metrics as fires are likely to expand beyond single patches. Think about metrics describing shape complexity and aggregations when working with fires.</p>
</div>
</div>
<p><strong><em>Question 1: Provide the rationale for each new metric that you selected for your analysis using a bullet point for each.</em></strong></p>
<p><strong><em>Question 2: Why may metric redundancy be an issue in the analysis of landscape patterns?</em></strong></p>
</section>
</section>
<section id="working-with-continuous-data" class="level1">
<h1>Working with continuous data</h1>
<p>One thing we stressed at the beginning is that landscape metrics can only be calculated on categorical rasters. But what if we started with a continuous raster where pixels can take any number, say, from 1 to 2? That would be a problem. One simple workaround is establishing a <strong>threshold</strong> such that values above or below such threshold are assigned to a class or another. However, the way you set a threshold will influence the output you get, similarly to setting the neighboring rule. We have already encountered this threshold at the beginning of the lab, but we glossed over it.</p>
<p>In our lab example, fires can be detected using satellite-derived indexes that describe how “burned” a pixel is based on its spectral properties. In simple words, we look at how “bright” the pixel is in 2 wavelengths and we compare these values over time (<a href="#eq-dnbr" class="quarto-xref">Equation&nbsp;1</a>). An increase in dNBR may be indicative of a fire. The higher dNBR, the higher the severity of the fire.</p>
<p><span class="math display">\[ NBR = \frac{(NIR - SWIR)}{(NIR + SWIR)} ∈ (0, 1) \]</span> <span id="eq-dnbr"><span class="math display">\[ dNBR = (PreFireNBR - PostFireNBR) ∈ (0, 1)  \tag{1}\]</span></span></p>
<p>Where NIR is the near infrared wavelength and SWIR is the short-wave infrared wavelength.</p>
<p>If you take a closer look at the metrics we computed earlier and plot them (<a href="#fig-boxes" class="quarto-xref">Figure&nbsp;4</a>), you would notice that we have 2 threshold values, specifically for dNBR. A low threshold indicates that fires are characterized early, or when they are less severe. A higher threshold only characterizes high severity fires. A low threshold value results in a higher contagion value, indicating a higher aggregation level than high severity fires (mostly because we include lower severity fires as well), as well as less complex shapes as indicated by the lower edge density values. Similarly, class-level metrics indicate larger and more patches on average for the burned class. Inverse trends are expected for the unburned area class.</p>
<div class="cell" data-layout-nrow="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute metrics</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>metrics_landscape <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(<span class="at">landscape=</span>flagged, <span class="at">what =</span> <span class="fu">c</span>(<span class="st">"lsm_l_ed"</span>, <span class="st">"lsm_l_contag"</span>), <span class="at">neighbourhood =</span> <span class="dv">8</span>, <span class="at">directions =</span> <span class="dv">8</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>metrics_class <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(<span class="at">landscape=</span>flagged, <span class="at">what =</span> <span class="fu">c</span>(<span class="st">"lsm_c_pland"</span>, <span class="st">"lsm_c_np"</span>, <span class="st">"lsm_c_area_mn"</span>), <span class="at">neighbourhood =</span> <span class="dv">8</span>, <span class="at">directions =</span> <span class="dv">8</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># recode metrics</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>metrics_landscape <span class="ot">&lt;-</span> metrics_landscape <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">layer =</span> <span class="fu">recode</span>(layer,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"fire_1_high"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"fire_1_low"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"fire_2_high"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"fire_2_low"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"fire_3_high"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"fire_3_low"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"fire_4_high"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"fire_4_low"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">"9"</span> <span class="ot">=</span> <span class="st">"fire_5_high"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"fire_5_low"</span>))</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>metrics_class <span class="ot">&lt;-</span> metrics_class <span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">layer =</span> <span class="fu">recode</span>(layer,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"fire_1_high"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"fire_1_low"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"fire_2_high"</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>         <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"fire_2_low"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>         <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"fire_3_high"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"fire_3_low"</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"fire_4_high"</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"fire_4_low"</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>         <span class="st">"9"</span> <span class="ot">=</span> <span class="st">"fire_5_high"</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"fire_5_low"</span>))</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>metrics_landscape <span class="ot">&lt;-</span> metrics_landscape <span class="sc">%&gt;%</span> </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(layer, metric), as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col=</span>layer, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"fire"</span>, <span class="st">"landscape"</span>, <span class="st">"threshold"</span>), <span class="at">sep=</span><span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rule =</span> <span class="st">"8"</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>metrics_class <span class="ot">&lt;-</span> metrics_class <span class="sc">%&gt;%</span> </span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(layer, class, metric), as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col=</span>layer, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"fire"</span>, <span class="st">"landscape"</span>, <span class="st">"threshold"</span>), <span class="at">sep=</span><span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rule =</span> <span class="st">"8"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metrics_landscape, <span class="fu">aes</span>(<span class="at">x=</span>threshold, <span class="at">y=</span>value)) <span class="sc">+</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">col=</span>landscape), <span class="at">size=</span><span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(metric<span class="sc">~</span>., <span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metrics_class, <span class="fu">aes</span>(<span class="at">x=</span>threshold, <span class="at">y=</span>value, <span class="at">fill=</span>class)) <span class="sc">+</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">outlier.shape=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(metric<span class="sc">~</span>class, <span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"tan4"</span>), </span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name=</span><span class="st">"Class"</span>,</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Unburned"</span>, <span class="st">"Burned"</span>)) <span class="sc">+</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"dNBR Threshold"</span>) <span class="sc">+</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-boxes" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-boxes" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-boxes-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-boxes-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-boxes-1.png" id="fig-boxes-1" class="img-fluid figure-img" data-ref-parent="fig-boxes" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-boxes-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-boxes" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-boxes-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-boxes-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-boxes-2.png" id="fig-boxes-2" class="img-fluid figure-img" data-ref-parent="fig-boxes" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-boxes-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Plotted landscape-level and class-level metrics for fire under 2 different threshold values for dNBR
</figcaption>
</figure>
</div>
</div>
<p><strong><em>Question 3: Briefly describe using bullet points 3 main differences in spatial patterns that where characterized by the low vs.&nbsp;high dNBR thresholds. Refer to your 5 new landscape metrics in the answer.</em></strong></p>
<p><strong><em>Question 4: Briefly describe how a change in neighboring rule may affect the quantitative estimates of burn patterns. Did all metrics change in the same way?</em></strong></p>
<p><strong><em>Question 5: How does the choice of the landscape metrics and threshold affect the ecological interpretation of the burned patterns on the landscape?</em></strong></p>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>We have explored the use of landscape metrics to understand landscape patterns and their change over time. New metrics are constantly developed, however their ecological meaning must be carefully assessed against the task at hand. In conclusion, while 2D landscape metrics are easy to understand and calculate, ecologists are getting more interested in 3D metrics (or “morphometrics”). To learn more, check out <span class="citation" data-cites="lepczyk2021">Lepczyk et al. (<a href="#ref-lepczyk2021" role="doc-biblioref">2021</a>)</span>.</p>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bosch2019" class="csl-entry" role="listitem">
Bosch, Martı́. 2019. <span>“PyLandStats: An Open-Source Pythonic Library to Compute Landscape Metrics.”</span> <em>PLoS One</em> 14 (12): e0225734.
</div>
<div id="ref-gergel2017" class="csl-entry" role="listitem">
Gergel, Sarah E, and Monica G Turner. 2017. <em>Learning Landscape Ecology: A Practical Guide to Concepts and Techniques</em>. Springer.
</div>
<div id="ref-hesselbarth2019" class="csl-entry" role="listitem">
Hesselbarth, Maximilian H. K., Marco Sciaini, Kimberly A. With, Kerstin Wiegand, and Jakub Nowosad. 2019. <span>“Landscapemetrics: An Open-Source r Tool to Calculate Landscape Metrics.”</span> <em>Ecography</em> 42: 1648–57.
</div>
<div id="ref-lepczyk2021" class="csl-entry" role="listitem">
Lepczyk, Christopher A, Lisa M Wedding, Gregory P Asner, Simon J Pittman, Tristan Goulden, Marc A Linderman, Jeanne Gang, and Rosalie Wright. 2021. <span>“Advancing Landscape and Seascape Ecology from a 2D to a 3D Science.”</span> <em>BioScience</em> 71 (6): 596–608.
</div>
<div id="ref-mcgarigal1995" class="csl-entry" role="listitem">
McGarigal, Kevin. 1995. <em>FRAGSTATS: Spatial Pattern Analysis Program for Quantifying Landscape Structure</em>. Vol. 351. US Department of Agriculture, Forest Service, Pacific Northwest Research Station.
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>